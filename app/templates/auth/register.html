{% extends "layouts/auth.html" %}

{% block title %}{{ _('Create Account - WebApp') }}{% endblock %}

{% block page_content %}
<div class="min-h-screen bg-gradient-to-br from-secondary-50 via-white to-primary-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
            <div
                class="inline-flex items-center justify-center w-16 h-16 rounded-lg bg-gradient-to-r from-primary-500 to-accent-500 mb-6">
                <i class="fas fa-user-plus text-2xl text-white"></i>
            </div>
            <h1 class="text-4xl font-display font-bold text-secondary-900 mb-4">{{ _('Join Our Community') }}</h1>
            <p class="text-lg text-secondary-600 max-w-2xl mx-auto mb-6">
                {{ _('Create your account to unlock powerful features and connect with professionals worldwide.') }}
            </p>
            <div class="inline-flex items-center space-x-2 text-sm text-secondary-500">
                <span>{{ _('Already have an account?') }}</span>
                <a href="{{ url_for('auth.login') }}"
                    class="font-semibold text-primary-600 hover:text-primary-700 transition-colors duration-200">
                    {{ _('Sign in here') }} â†’
                </a>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-primary-600 text-white text-sm font-medium step-indicator"
                        data-step="1">1</div>
                    <div class="w-16 h-1 bg-gray-200 step-line"></div>
                </div>
                <div class="flex items-center">
                    <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-gray-200 text-gray-500 text-sm font-medium step-indicator"
                        data-step="2">2</div>
                    <div class="w-16 h-1 bg-gray-200 step-line"></div>
                </div>
                <div class="flex items-center">
                    <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-gray-200 text-gray-500 text-sm font-medium step-indicator"
                        data-step="3">3</div>
                    <div class="w-16 h-1 bg-gray-200 step-line"></div>
                </div>
                <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-gray-200 text-gray-500 text-sm font-medium step-indicator"
                    data-step="4">4</div>
            </div>
            <div class="flex justify-between mt-2 text-xs text-secondary-500">
                <span>{{ _('Profile') }}</span>
                <span>{{ _('Location') }}</span>
                <span>{{ _('Account') }}</span>
                <span>{{ _('Security') }}</span>
            </div>
        </div>

        <!-- Registration Form -->
        <div class="bg-white/90 backdrop-blur-xl rounded-lg border border-secondary-200/50 overflow-hidden">
            <form method="POST" enctype="multipart/form-data" class="p-8 lg:p-12">
                {{ form.hidden_tag() }}

                <!-- Step 1: Profile Setup -->
                <div class="form-step" id="step-1">
                    <div class="mb-8">
                        <div class="flex items-center mb-6">
                            <div
                                class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-r from-primary-500 to-accent-500 mr-4">
                                <i class="fas fa-user text-white text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-display font-bold text-secondary-900">{{ _('Profile Setup') }}</h2>
                                <p class="text-secondary-600">{{ _('Tell us about yourself') }}</p>
                            </div>
                        </div>

                        <!-- Profile Image Upload -->
                        <div class="mb-8">
                            <label class="block text-sm font-semibold text-secondary-700 mb-4">{{ _('Profile Picture') }}</label>
                            <div class="flex items-center space-x-8">
                                <div class="relative">
                                    <img id="profile-preview"
                                        class="w-24 h-24 object-cover rounded-lg border-2 border-secondary-200"
                                        src="https://ui-avatars.com/api/?name=Profile&background=0ea5e9&color=ffffff&size=200&rounded=true"
                                        alt="{{ _('Profile preview') }}">
                                    <div
                                        class="absolute inset-0 rounded-lg bg-gradient-to-t from-secondary-900/20 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                        <i class="fas fa-camera text-white text-lg"></i>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <label class="group relative block">
                                        <div
                                            class="flex items-center justify-center w-full h-20 border-2 border-dashed border-secondary-300 rounded-lg hover:border-primary-400 transition-colors duration-200 cursor-pointer group-hover:bg-primary-50/50">
                                            <div class="text-center">
                                                <i
                                                    class="fas fa-cloud-upload-alt text-2xl text-secondary-400 group-hover:text-primary-500 mb-2"></i>
                                                <p
                                                    class="text-sm font-medium text-secondary-600 group-hover:text-primary-600">
                                                    {{ _('Choose or drag a photo') }}</p>
                                                <p class="text-xs text-secondary-500">{{ _('PNG, JPG up to 5MB') }}</p>
                                            </div>
                                        </div>
                                        {{ form.profile_image(class="absolute inset-0 w-full h-full opacity-0
                                        cursor-pointer",
                                        onchange="handleImagePreview(event)", accept="image/*") }}
                                    </label>
                                    {% if form.profile_image.errors %}
                                    <div class="mt-2">
                                        {% for error in form.profile_image.errors %}
                                        <p class="text-sm text-danger-600 flex items-center">
                                            <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                        </p>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- First Name -->
                            <div>
                                {{ form.first_name.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                                {{ form.first_name(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                text-secondary-900", placeholder=_("Enter your first name")) }}
                                {% if form.first_name.errors %}
                                <div class="mt-2">
                                    {% for error in form.first_name.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Last Name -->
                            <div>
                                {{ form.last_name.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                                {{ form.last_name(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                text-secondary-900", placeholder=_("Enter your last name")) }}
                                {% if form.last_name.errors %}
                                <div class="mt-2">
                                    {% for error in form.last_name.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Email -->
                            <div>
                                {{ form.email.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                                {{ form.email(class="w-full px-4 py-3 border border-secondary-200 rounded-md bg-white/70
                                backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                text-secondary-900", placeholder=_("your.email@example.com")) }}
                                {% if form.email.errors %}
                                <div class="mt-2">
                                    {% for error in form.email.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Phone Number -->
                            <div>
                                {{ form.phone_number.label(class="block text-sm font-semibold text-secondary-700 mb-3")
                                }}
                                {{ form.phone_number(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                text-secondary-900", placeholder=_("+1 (555) 123-4567")) }}
                                {% if form.phone_number.errors %}
                                <div class="mt-2">
                                    {% for error in form.phone_number.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Date of Birth -->
                        <div class="mt-6">
                            {{ form.date_of_birth.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                            {{ form.date_of_birth(class="w-full max-w-md px-4 py-3 border border-secondary-200
                            rounded-md bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2
                            focus:ring-primary-500 focus:border-primary-500 transition-all duration-200
                            text-secondary-900") }}
                            {% if form.date_of_birth.errors %}
                            <div class="mt-2">
                                {% for error in form.date_of_birth.errors %}
                                <p class="text-sm text-danger-600 flex items-center">
                                    <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                </p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Step 1 Navigation -->
                    <div class="flex justify-between pt-6 border-t border-secondary-200">
                        <div></div>
                        <button type="button" onclick="nextStep(2)"
                            class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-accent-600 text-white font-semibold rounded-lg hover:from-primary-700 hover:to-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
                            {{ _('Next') }}
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Location Information -->
                <div class="form-step hidden" id="step-2">
                    <div class="mb-8">
                        <div class="flex items-center mb-6">
                            <div
                                class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-r from-secondary-500 to-primary-500 mr-4">
                                <i class="fas fa-map-marker-alt text-white text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-display font-bold text-secondary-900">{{ _('Location') }}</h2>
                                <p class="text-secondary-600">{{ _('Where are you based?') }}</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Country -->
                            <div>
                                {{ form.country.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                                {{ form.country(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 text-secondary-900") }}
                                {% if form.country.errors %}
                                <div class="mt-2">
                                    {% for error in form.country.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <!-- City -->
                            <div>
                                {{ form.city.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                                {{ form.city(class="w-full px-4 py-3 border border-secondary-200 rounded-md bg-white/70
                                backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                text-secondary-900", placeholder=_("Enter your city")) }}
                                {% if form.city.errors %}
                                <div class="mt-2">
                                    {% for error in form.city.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="mt-6">
                            {{ form.address.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                            {{ form.address(class="w-full px-4 py-3 border border-secondary-200 rounded-md bg-white/70
                            backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                            focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                            text-secondary-900", placeholder=_("Street address (optional)")) }}
                            {% if form.address.errors %}
                            <div class="mt-2">
                                {% for error in form.address.errors %}
                                <p class="text-sm text-danger-600 flex items-center">
                                    <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                </p>
                                {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Step 2 Navigation -->
                    <div class="flex justify-between pt-6 border-t border-secondary-200">
                        <button type="button" onclick="prevStep(1)"
                            class="inline-flex items-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition-all duration-200">
                            <i class="fas fa-arrow-left mr-2"></i>
                            {{ _('Previous') }}
                        </button>
                        <button type="button" onclick="nextStep(3)"
                            class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-accent-600 text-white font-semibold rounded-lg hover:from-primary-700 hover:to-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
                            {{ _('Next') }}
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Account Settings -->
                <div class="form-step hidden" id="step-3">
                    <div class="mb-8">
                        <div class="flex items-center mb-6">
                            <div
                                class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-r from-accent-500 to-warning-500 mr-4">
                                <i class="fas fa-cog text-white text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-display font-bold text-secondary-900">{{ _('Account Settings') }}</h2>
                                <p class="text-secondary-600">{{ _('Customize your experience') }}</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Preferred Language -->
                            <div>
                                {{ form.preferred_language.label(class="block text-sm font-semibold text-secondary-700
                                mb-3") }}
                                {{ form.preferred_language(class="w-full px-4 py-3 border border-secondary-200
                                rounded-md bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2
                                focus:ring-primary-500 focus:border-primary-500 transition-all duration-200
                                text-secondary-900") }}
                                {% if form.preferred_language.errors %}
                                <div class="mt-2">
                                    {% for error in form.preferred_language.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Account Type -->
                            <div>
                                {{ form.account_type.label(class="block text-sm font-semibold text-secondary-700 mb-3")
                                }}
                                {{ form.account_type(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 text-secondary-900",
                                onchange="toggleBusinessFields(this.value)") }}
                                {% if form.account_type.errors %}
                                <div class="mt-2">
                                    {% for error in form.account_type.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Business Information (conditional) -->
                        <div id="business-fields" class="mt-8 space-y-6 hidden">
                            <div class="p-6 bg-slate-50/80 rounded-lg border border-slate-200">
                                <h3 class="text-lg font-semibold text-secondary-900 mb-4 flex items-center">
                                    <i class="fas fa-building text-primary-600 mr-2"></i>
                                    {{ _('Business Information (Optional)') }}
                                </h3>

                                <!-- Business Name -->
                                <div class="mb-6">
                                    {{ form.business_name.label(class="block text-sm font-semibold text-secondary-700
                                    mb-3") }}
                                    {{ form.business_name(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                    bg-white focus:outline-none focus:ring-2 focus:ring-primary-500
                                    focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                    text-secondary-900", placeholder=_("Your business name")) }}
                                    {% if form.business_name.errors %}
                                    <div class="mt-2">
                                        {% for error in form.business_name.errors %}
                                        <p class="text-sm text-danger-600 flex items-center">
                                            <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                        </p>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Business Type -->
                                    <div>
                                        {{ form.business_type.label(class="block text-sm font-semibold
                                        text-secondary-700 mb-3") }}
                                        {{ form.business_type(class="w-full px-4 py-3 border border-secondary-200
                                        rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-primary-500
                                        focus:border-primary-500 transition-all duration-200 text-secondary-900") }}
                                        {% if form.business_type.errors %}
                                        <div class="mt-2">
                                            {% for error in form.business_type.errors %}
                                            <p class="text-sm text-danger-600 flex items-center">
                                                <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                            </p>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>

                                    <!-- Website URL -->
                                    <div>
                                        {{ form.website_url.label(class="block text-sm font-semibold text-secondary-700
                                        mb-3") }}
                                        {{ form.website_url(class="w-full px-4 py-3 border border-secondary-200
                                        rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-primary-500
                                        focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                        text-secondary-900", placeholder=_("https://yourbusiness.com")) }}
                                        {% if form.website_url.errors %}
                                        <div class="mt-2">
                                            {% for error in form.website_url.errors %}
                                            <p class="text-sm text-danger-600 flex items-center">
                                                <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                            </p>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Business Description -->
                                <div class="mt-6">
                                    {{ form.business_description.label(class="block text-sm font-semibold
                                    text-secondary-700 mb-3") }}
                                    {{ form.business_description(class="w-full px-4 py-3 border border-secondary-200
                                    rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-primary-500
                                    focus:border-primary-500 transition-all duration-200 placeholder-secondary-400
                                    text-secondary-900 resize-none", rows="4", placeholder=_("Brief description of your
                                    business...")) }}
                                    {% if form.business_description.errors %}
                                    <div class="mt-2">
                                        {% for error in form.business_description.errors %}
                                        <p class="text-sm text-danger-600 flex items-center">
                                            <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                        </p>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 Navigation -->
                    <div class="flex justify-between pt-6 border-t border-secondary-200">
                        <button type="button" onclick="prevStep(2)"
                            class="inline-flex items-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition-all duration-200">
                            <i class="fas fa-arrow-left mr-2"></i>
                            {{ _('Previous') }}
                        </button>
                        <button type="button" onclick="nextStep(4)"
                            class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-accent-600 text-white font-semibold rounded-lg hover:from-primary-700 hover:to-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
                            {{ _('Next') }}
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Security -->
                <div class="form-step hidden" id="step-4">
                    <div class="mb-8">
                        <div class="flex items-center mb-6">
                            <div
                                class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-r from-danger-500 to-warning-500 mr-4">
                                <i class="fas fa-lock text-white text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-display font-bold text-secondary-900">{{ _('Security') }}</h2>
                                <p class="text-secondary-600">{{ _('Choose a strong password') }}</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Password -->
                            <div>
                                {{ form.password.label(class="block text-sm font-semibold text-secondary-700 mb-3") }}
                                {{ form.password(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 text-secondary-900") }}
                                {% if form.password.errors %}
                                <div class="mt-2">
                                    {% for error in form.password.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                                <p class="mt-2 text-xs text-secondary-500 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    {{ _('Minimum 8 characters with letters and numbers') }}
                                </p>
                            </div>

                            <!-- Confirm Password -->
                            <div>
                                {{ form.password_confirm.label(class="block text-sm font-semibold text-secondary-700
                                mb-3") }}
                                {{ form.password_confirm(class="w-full px-4 py-3 border border-secondary-200 rounded-md
                                bg-white/70 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-primary-500
                                focus:border-primary-500 transition-all duration-200 text-secondary-900") }}
                                {% if form.password_confirm.errors %}
                                <div class="mt-2">
                                    {% for error in form.password_confirm.errors %}
                                    <p class="text-sm text-danger-600 flex items-center">
                                        <i class="fas fa-exclamation-circle mr-2"></i>{{ _(error) }}
                                    </p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Password Requirements -->
                        <div class="mt-6 p-4 bg-slate-50/80 rounded-lg border border-slate-200">
                            <h4 class="text-sm font-semibold text-slate-900 mb-3">{{ _('Password Requirements:') }}</h4>
                            <ul class="text-sm text-slate-600 space-y-1">
                                <li class="flex items-center">
                                    <i class="fas fa-check text-success-500 mr-2 text-xs"></i>
                                    {{ _('At least 8 characters long') }}
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-success-500 mr-2 text-xs"></i>
                                    {{ _('Contains letters and numbers') }}
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-success-500 mr-2 text-xs"></i>
                                    {{ _('Special characters recommended') }}
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Step 4 Navigation -->
                    <div class="flex justify-between pt-6 border-t border-secondary-200">
                        <button type="button" onclick="prevStep(3)"
                            class="inline-flex items-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition-all duration-200">
                            <i class="fas fa-arrow-left mr-2"></i>
                            {{ _('Previous') }}
                        </button>
                        <button type="submit"
                            class="inline-flex items-center px-8 py-3 bg-gradient-to-r from-success-600 to-primary-600 text-white font-semibold rounded-lg hover:from-success-700 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-success-500 transition-all duration-200">
                            <i class="fas fa-user-plus mr-2"></i>
                            {{ _('Create Account') }}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let currentStep = 1;
    const totalSteps = 4;

    function showStep(step) {
        // Hide all steps
        for (let i = 1; i <= totalSteps; i++) {
            const stepElement = document.getElementById(`step-${i}`);
            if (stepElement) {
                stepElement.classList.add('hidden');
            }
        }

        // Show current step
        const currentStepElement = document.getElementById(`step-${step}`);
        if (currentStepElement) {
            currentStepElement.classList.remove('hidden');
        }

        // Update progress indicators
        updateProgressIndicators(step);

        // Scroll to top of form
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateProgressIndicators(step) {
        for (let i = 1; i <= totalSteps; i++) {
            const indicator = document.querySelector(`[data-step="${i}"]`);
            const line = indicator?.parentElement?.querySelector('.step-line');

            if (indicator) {
                if (i < step) {
                    // Completed step
                    indicator.classList.remove('bg-gray-200', 'text-gray-500', 'bg-primary-600');
                    indicator.classList.add('bg-success-600', 'text-white');
                    indicator.innerHTML = '<i class="fas fa-check text-xs"></i>';
                } else if (i === step) {
                    // Current step
                    indicator.classList.remove('bg-gray-200', 'text-gray-500', 'bg-success-600');
                    indicator.classList.add('bg-primary-600', 'text-white');
                    indicator.innerHTML = i;
                } else {
                    // Future step
                    indicator.classList.remove('bg-primary-600', 'bg-success-600', 'text-white');
                    indicator.classList.add('bg-gray-200', 'text-gray-500');
                    indicator.innerHTML = i;
                }
            }

            if (line) {
                if (i < step) {
                    line.classList.remove('bg-gray-200');
                    line.classList.add('bg-success-400');
                } else {
                    line.classList.remove('bg-success-400');
                    line.classList.add('bg-gray-200');
                }
            }
        }
    }

    function nextStep(step) {
        if (validateCurrentStep()) {
            currentStep = step;
            showStep(currentStep);
        }
    }

    function prevStep(step) {
        currentStep = step;
        showStep(currentStep);
    }

    function validateCurrentStep() {
        const currentStepElement = document.getElementById(`step-${currentStep}`);
        if (!currentStepElement) return true;

        const requiredFields = currentStepElement.querySelectorAll('input[required], select[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('border-danger-300');
                isValid = false;
            } else {
                field.classList.remove('border-danger-300');
            }
        });

        if (!isValid) {
            // Show error message or handle validation feedback
            console.log('Please fill in all required fields');
        }

        return isValid;
    }

    function toggleBusinessFields(accountType) {
        const businessFields = document.getElementById('business-fields');
        if (accountType === 'business' || accountType === 'both') {
            businessFields.classList.remove('hidden');
        } else {
            businessFields.classList.add('hidden');
        }
    }

    function handleImagePreview(event) {
        const file = event.target.files[0];
        const preview = document.querySelector('img[alt="{{ _("Profile preview") }}"]');

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function () {
        // Show first step
        showStep(1);

        // Initialize business fields
        const accountTypeSelect = document.getElementById('account_type');
        if (accountTypeSelect) {
            toggleBusinessFields(accountTypeSelect.value);
        }

        // Add form submission handler
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function (e) {
                if (!validateCurrentStep()) {
                    e.preventDefault();
                }
            });
        }

        // Add smooth scrolling for form sections
        const formInputs = document.querySelectorAll('input, select, textarea');
        formInputs.forEach(input => {
            input.addEventListener('focus', function () {
                setTimeout(() => {
                    this.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }, 100);
            });
        });
    });
</script>
{% endblock %}
